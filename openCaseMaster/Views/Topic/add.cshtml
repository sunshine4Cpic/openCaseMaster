@using openCaseMaster.ViewModels
@model topicModel
@{string action = ViewBag.action == null ? "add" : (ViewBag.action as string);}
@section Scripts {
    @Styles.Render("~/Content/bootstrap-select")
    @Scripts.Render("~/bundles/bootstrap-select")

    @Scripts.Render("~/bundles/jqueryval")

    @Scripts.Render("~/bundles/markdown")

    @Styles.Render("~/Content/markdown")

    
<script type="text/javascript">

    

    $(function () {

        @if (action == "add" && Model==null)
        {
            @:$("#md").val(localStorage["markdown"]);
        }

        editormd("editormd", {
            name: "body",
            //theme: "dark",
            //previewTheme: "dark",
            //editorTheme: "pastel-on-dark",
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "/UploadFile/imgUpLoad",
            toolbarIcons: function () {
                return ["undo", "redo", "|", "watch", "preview", "|", "bold", "del", "italic", "hr", "|", "h1", "h2", "h3", "|", "link", "image", "emoji", "table", "code-block", "datetime", "||", "watch", "preview"]
            },
            watch: false,
            lineNumbers: false,
            height: 520,
            path: '/Scripts/editormd/lib/',
            //markdown: localStorage["addTask"],
            markdown: $("#md").val(),
            emoji: true,
            delay: 1000,
            @if (action == "add")
            {
                @:onchange: function () {
                @:    localStorage.setItem("markdown", this.getMarkdown());
                @:}
            }
        });
    });


</script>


}



@using (Html.BeginForm(action, "Topic", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    @Html.ValidationMessageFor(m => m.node, "", new { @class = "text-danger" })

    if (Model!=null)
    {
        @Html.HiddenFor(t => t.ID, new { @name = "ID" });
    }
   
    <div class="panel panel-default">
        <div class="panel-heading">创建话题</div>
        <div class="panel-body">
            <div class="form-group">
                <div class="input-group">
                    <span class="node-select input-group-btn">
                        @Html.DropDownListFor(t => t.node, ViewBag.nodes as List<SelectListItem>, new { @class = "selectpicker", @data_live_search = "true", @data_width = "140px" })
                    </span>
                    @Html.TextBoxFor(m => m.title, new { @class = "form-control", @placeholder = "在这里填写标题" })
                </div>
            </div>


            <div class="tab-pane fade in active" id="edit">
                <div id="editormd"></div>
            </div>
            @if (Model == null)
            {
                <textarea id="md" hidden></textarea>
            }
            else
            {
                <textarea id="md" hidden>@Model.body</textarea>
            }

        
            <br />
            <div class="form-group">
                <input type="submit" value="保存" class="btn btn-primary col-xs-2" />

                <div class="pull-right"><a href="/Topic/markdown" target="_blank"><i class="fa fa-tip"></i> 排版说明</a></div>
            </div>


        </div>
    </div>

}


